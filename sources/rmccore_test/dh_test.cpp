#include "stdafx.h"

#include "rmccore/crypto/dh.h"
#include <boost/test/unit_test.hpp>

using namespace RMCCORE;
using namespace RMCCORE::CRYPT;

static const char* cert1 = "-----BEGIN CERTIFICATE-----\n\
MIIGGTCCBQGgAwIBAgIkNGExMzNhNTktYmFhZS00YzU3LWEwZTItNjM3MDllMjE3NmQxMA0GCSqG\n\
SIb3DQEBBQUAMGwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRIwEAYDVQQHEwlT\n\
YW4gTWF0ZW8xDDAKBgNVBAsTA3JtczERMA8GA1UEChMIbmV4dGxhYnMxEzARBgNVBAMTCnNreWRy\n\
bS5jb20wIBcNMTcxMjIxMDg0MjQ2WhgPMjExNzExMjcwODQyNDZaMHExCzAJBgNVBAYTAlVTMRMw\n\
EQYDVQQIEwpDYWxpZm9ybmlhMRIwEAYDVQQHEwlTYW4gTWF0ZW8xDDAKBgNVBAsTA3JtczERMA8G\n\
A1UEChMIbmV4dGxhYnMxGDAWBgNVBAMMD20xMzNAc2t5ZHJtLmNvbTCCAyowggIcBgkqhkiG9w0B\n\
AwEwggINAoIBAQDTEBJbKU29hWgU39S6tNx2ffapmcnt+o+NexJVH41x72AyNXQFx/Ee4UfbAzJx\n\
b8j9he0CdYUmg2DRa9dhVj19FlnU1z2u1hfz5CI/SLzvpCGGDD/EOT0nVFZ3siRZ6FL1JU06xYwN\n\
Y9153i2NhozZQN7PWidGBdsO7nYgIMOdD2SGYGWA6qzOFvtw+3x1nqmqurTcv5QYkbDOlOxNPVlU\n\
IXxuhKknTxq4YHO9+dyFHlY7kEVbg5fa46G5mGB7t2mc6ggFp/8BPvRP3nr4MPH9BR/67FOc5EUt\n\
gikJiuPuIAirnbeyyUgxLLwBN8CC1mcmGOG/5dUAboENx6p/Hm7jAoIBAGSs66X3vIA+8pcxycau\n\
AJuG/FIB+BvCuPhIkPz3HK1RwUKf0mGipxXIlGFU4OTijvay1JPMFzn1ZZ6fFN0UA39f5ys7pNm8\n\
s7lbhBe9pI8RjmHIIUz41VjaZ3Twi1jZeyzOIPWqL46VOcAU53YeTmM2z/w1En3dUnIGdmrnIEXB\n\
Gw/02nYXJSNxOzHJ8Yq6upJhK94QUUHwTbXaPDnN5caHe3+M2WlJ/Mh24sEiT7kYjXFP3Wy4BoL4\n\
lngzrUtRNUqNWFmOay3vRXGll605vTF31UskylGO2plu7bqKMdWHbv7YqkQCPMnxPYbctN3884nH\n\
oUNQgu9pcDYDY4MllU4CAgQAA4IBBgACggEBAKnkIJD9LD89yDAzX670NgR2Feavzu6lFA2jq4t2\n\
z+ktWPlOsF41MmVCwSdg3htptKzT5D34IYXOw8DBV7sETOLKjG2QQx2zGXwlR8vh9BGfqeQwvy6f\n\
qQvkcC2stT0cJ2HFemh5ZxtkuBs0FrTO7hlvwa0644lFJIov8HOerG6gES97LiMn3w8kkT5mrcig\n\
dIiFkEFysaHgQmhJr+c13c01EGxrQU7oKI1wxDjoKv6i1r4vOFcp3xdS7rEwVndjJGHUvyXfe6sb\n\
4x7ZxfOS/TujZvWGvIyXml7VLxQKvfUajU1o4XWQbxtD7TFvDSS2As3SEfNNpG5kNwiiR9YYE72j\n\
gZMwgZAwHQYDVR0OBBYEFIxeOAV13+13hSJMx6H+by/so/LLMB8GA1UdIwQYMBaAFKjEPhqSfew9\n\
38+psHvUG5F/ytLlMAwGA1UdEwEB/wQCMAAwEQYJYIZIAYb4QgEBBAQDAgbAMA4GA1UdDwEB/wQE\n\
AwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDQYJKoZIhvcNAQEFBQADggEBACfs\n\
M5qLTBSrLT9edypD7e+wQmxEl7cCJr2aB5bVkuBo5ZJB2aFT76/+XSF7moqlG6DhPuqEa4kNRVtX\n\
4p2tl3QQ6h8NeQL+e+snm+VV1APqfB0nKpV2u50Eb8EGqu23TWAP4FS/TcFDSIVRukjf4cCxwdoW\n\
t+3lrRfgmcX9WkVSQZ5ajzRpQDpQlNU7oV1RxE9aLpkzsJ1d1KgDd/4KsAcpdk7fedDS2xVzaDvp\n\
nrn4KdldlHz3Hb3Mvu1Ga4/sTDzNqji8e13TAKc3J//GOBnfFAa0jLTfOqxNu/3dNHfo2z1SxIJH\n\
ca4sX8oA7+bMrRGooC2HIfUZK4THdLBfzgk=\n\
-----END CERTIFICATE-----";

static const char* cert2 = "-----BEGIN CERTIFICATE-----\n\
MIIGFjCCBP6gAwIBAgIkODQwYmNlZDYtMjUxZS00OTM3LTlmY2MtYzQ0MDdiZTYxOTdhMA0GCSqG\n\
SIb3DQEBBQUAMG4xCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRIwEAYDVQQHEwlT\n\
YW4gTWF0ZW8xDDAKBgNVBAsTA3JtczERMA8GA1UEChMIbmV4dGxhYnMxFTATBgNVBAMTDGMuc2t5\n\
ZHJtLmNvbTAgFw0xNjA4MDMwNDAzMTlaGA8yMTE2MDcxMDA0MDMxOVowbDELMAkGA1UEBhMCVVMx\n\
EzARBgNVBAgTCkNhbGlmb3JuaWExEjAQBgNVBAcTCVNhbiBNYXRlbzEMMAoGA1UECxMDcm1zMREw\n\
DwYDVQQKEwhuZXh0bGFiczETMBEGA1UEAxMKc2t5ZHJtLmNvbTCCAyowggIcBgkqhkiG9w0BAwEw\n\
ggINAoIBAQDTEBJbKU29hWgU39S6tNx2ffapmcnt+o+NexJVH41x72AyNXQFx/Ee4UfbAzJxb8j9\n\
he0CdYUmg2DRa9dhVj19FlnU1z2u1hfz5CI/SLzvpCGGDD/EOT0nVFZ3siRZ6FL1JU06xYwNY915\n\
3i2NhozZQN7PWidGBdsO7nYgIMOdD2SGYGWA6qzOFvtw+3x1nqmqurTcv5QYkbDOlOxNPVlUIXxu\n\
hKknTxq4YHO9+dyFHlY7kEVbg5fa46G5mGB7t2mc6ggFp/8BPvRP3nr4MPH9BR/67FOc5EUtgikJ\n\
iuPuIAirnbeyyUgxLLwBN8CC1mcmGOG/5dUAboENx6p/Hm7jAoIBAGSs66X3vIA+8pcxycauAJuG\n\
/FIB+BvCuPhIkPz3HK1RwUKf0mGipxXIlGFU4OTijvay1JPMFzn1ZZ6fFN0UA39f5ys7pNm8s7lb\n\
hBe9pI8RjmHIIUz41VjaZ3Twi1jZeyzOIPWqL46VOcAU53YeTmM2z/w1En3dUnIGdmrnIEXBGw/0\n\
2nYXJSNxOzHJ8Yq6upJhK94QUUHwTbXaPDnN5caHe3+M2WlJ/Mh24sEiT7kYjXFP3Wy4BoL4lngz\n\
rUtRNUqNWFmOay3vRXGll605vTF31UskylGO2plu7bqKMdWHbv7YqkQCPMnxPYbctN3884nHoUNQ\n\
gu9pcDYDY4MllU4CAgQAA4IBBgACggEBAMvblCj//G4ZO8Y4ivu6fpCkTflbsJOMzsNNCybPEVXV\n\
xSUHcl34rTdc4EEXYQtIexPDs+ITgZWrHtT1rWBMcsrNLW+kBSKIdcsk60KHh/D3FUeCXdNmzf4y\n\
HdonhFFw7NhqY2+D80IunrXam2wt9GipcnQHssm56Cjp9eI0zEIWZdswbGBOMlLMUQea86hJzrky\n\
GEnUrS5H/lHepyBGPIGxA0eDFglmQijdpJ816v1bm4KKppmGhiAdV+7CHnqXPqaqXSe/TvGRzqzn\n\
sFHK5PtUOTYMqeMpWa8jTzirgRypQtAs9rhFk+06R0S1Y8NjBjvseTPkwUeM2GnuLRS+2z6jgZMw\n\
gZAwHQYDVR0OBBYEFHpIOWA7Dh/0XtIA09nrsjtgFIuyMB8GA1UdIwQYMBaAFCBszR96+Au6YYdR\n\
8q8ZfM929JeUMAwGA1UdEwEB/wQCMAAwEQYJYIZIAYb4QgEBBAQDAgbAMA4GA1UdDwEB/wQEAwIF\n\
oDAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDQYJKoZIhvcNAQEFBQADggEBAG/oR+v8\n\
923OLXotEpNhaZk/SZDHYs1RAMk83FV2Sd2sdjGpEIXvVB1nxh8D2d/a+oFz2s1n0ihAKvqqxd+Y\n\
k6KfNlV3FRnjtao5oTNWQF5pdNSqyBorz56v/8IoO9oMX4eVwhnA7pGGcdkWW4GLmCHMSJRDjWTD\n\
ZiDzRzKbYHSmTiZPGOsQ7kz0vXyK5yJHLDfu4fyK7FGNYVL6DT1Px5W+FWzunIWo0vDyBF5tNqKj\n\
JTC6I8zpFmxyf0ha6//obv+ztwfQthz22IkAK5Sum7tqEOzZeERgEOVkJGjev4PSuEKmfvPmW+4n\n\
aYoXAwgezX6fqAvoZGxyjwJY9N1ORVc=\n\
-----END CERTIFICATE-----";

static const char* cert3 = "-----BEGIN CERTIFICATE-----\n\
MIIFmTCCBIGgAwIBAgIkZTg2NDllZWYtNjIzOS00MDk2LWFmYTYtOTA4YjdjMzIzNWIwMA0GCSqG\n\
SIb3DQEBBQUAMG4xCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRIwEAYDVQQHEwlT\n\
YW4gTWF0ZW8xDDAKBgNVBAsTA3JtczERMA8GA1UEChMIbmV4dGxhYnMxFTATBgNVBAMTDGMuc2t5\n\
ZHJtLmNvbTAgFw0xNjA4MDIwNzAxMzVaGA8yMTE2MDcwOTA3MDEzNVowbjELMAkGA1UEBhMCVVMx\n\
EzARBgNVBAgTCkNhbGlmb3JuaWExEjAQBgNVBAcTCVNhbiBNYXRlbzEMMAoGA1UECxMDcm1zMREw\n\
DwYDVQQKEwhuZXh0bGFiczEVMBMGA1UEAxMMYy5za3lkcm0uY29tMIIDKTCCAhwGCSqGSIb3DQED\n\
ATCCAg0CggEBANMQElspTb2FaBTf1Lq03HZ99qmZye36j417ElUfjXHvYDI1dAXH8R7hR9sDMnFv\n\
yP2F7QJ1hSaDYNFr12FWPX0WWdTXPa7WF/PkIj9IvO+kIYYMP8Q5PSdUVneyJFnoUvUlTTrFjA1j\n\
3XneLY2GjNlA3s9aJ0YF2w7udiAgw50PZIZgZYDqrM4W+3D7fHWeqaq6tNy/lBiRsM6U7E09WVQh\n\
fG6EqSdPGrhgc7353IUeVjuQRVuDl9rjobmYYHu3aZzqCAWn/wE+9E/eevgw8f0FH/rsU5zkRS2C\n\
KQmK4+4gCKudt7LJSDEsvAE3wILWZyYY4b/l1QBugQ3Hqn8ebuMCggEAZKzrpfe8gD7ylzHJxq4A\n\
m4b8UgH4G8K4+EiQ/PccrVHBQp/SYaKnFciUYVTg5OKO9rLUk8wXOfVlnp8U3RQDf1/nKzuk2byz\n\
uVuEF72kjxGOYcghTPjVWNpndPCLWNl7LM4g9aovjpU5wBTndh5OYzbP/DUSfd1ScgZ2aucgRcEb\n\
D/TadhclI3E7Mcnxirq6kmEr3hBRQfBNtdo8Oc3lxod7f4zZaUn8yHbiwSJPuRiNcU/dbLgGgviW\n\
eDOtS1E1So1YWY5rLe9FcaWXrTm9MXfVSyTKUY7amW7tuoox1Ydu/tiqRAI8yfE9hty03fzziceh\n\
Q1CC72lwNgNjgyWVTgICBAADggEFAAKCAQB5Eo+eZrH9BBt17IbBnAj7RYDEky/W60XbSWxg/KG/\n\
q4SEfvQsA7o1b17LhJmJhf1x+TfRTlcIoxknRlsaUZtb/DAoXzQauq+oE5TVW1KDxHXhXy4DMfmi\n\
ZewIKcL7P9RJP8B+1aFwN772GASLtrXvsC0y7i4/Pxm6QdMNxxRq6Wr06mfK5ffPsp7R3anPEeGL\n\
3V9DKELJf9T9Q61M/iCiPCyE6+wto96HKxxnjJb+bTtkyV3TswXkVxOHy4xL0nvN9oDXUqdHD4+Y\n\
sf+eZqiHAVXJdjSXkSKZWdd0YhAPwN6ybOIZEhv+RlBbKBSIQjqZOyjHkjKp10ludsXtFCDEoxYw\n\
FDASBgNVHRMBAf8ECDAGAQH/AgEFMA0GCSqGSIb3DQEBBQUAA4IBAQBIohij0vE2xDRFk30gpW+L\n\
LIHrESdrHKV9teWzXyp7qA7R0c8M6tbOO9izRimEXEoIzAR8o3ZxClUMB0sjsMnbYxK+vT8yQbQa\n\
RhdQmQemPwuo6U1NkDZPpgd+lexlCA7BG+B1U8C/fTwrqiIOzB927OOophgJ4GsWpV9CC9P+euVi\n\
imq1FP2uxIYHqYlAQdbW7uMe2zhBsNeKN7AlxWagwXIU7KMe7tMjdgptzMVS+WJTU5QD++zPRjIE\n\
mQpxK3rPWNiVqldMP8Q4TA1MUqrcBspPCbNaKcG01RNFEq/uYyXISZr9f/xTISyspoJIScTcVAA4\n\
xyEhPgl/d2ZKeDrP\n\
-----END CERTIFICATE-----";

BOOST_AUTO_TEST_SUITE(RmcCoreCryptoTest)


BOOST_AUTO_TEST_CASE(TestDhGenerate)
{
    DhKey2048 dhk;

    BOOST_REQUIRE(!dhk.getP().empty());
    BOOST_REQUIRE(!dhk.getG().empty());
    BOOST_REQUIRE(!dhk.getX().empty());
    BOOST_REQUIRE(!dhk.getY().empty());

    const std::string& pem = dhk.getPubkeyPem();
    BOOST_REQUIRE(0 != pem.length());
}

BOOST_AUTO_TEST_CASE(TestDhImport)
{
    const DhKey& dk1 = DhKey::loadFromPem(cert1);
    BOOST_REQUIRE(!dk1.empty());
    const DhKey& dk2 = DhKey::loadFromPem(cert2);
    BOOST_REQUIRE(!dk2.empty());
    const DhKey& dk3 = DhKey::loadFromPem(cert3);
    BOOST_REQUIRE(!dk3.empty());
}

BOOST_AUTO_TEST_SUITE_END()
